# @format

name: Claude Auto Review with Tracking
on:
  pull_request:
    types: [opened, synchronize, ready_for_review, reopened]

jobs:
  review:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      id-token: write
    steps:
      - uses: actions/checkout@v5
        with:
          fetch-depth: 1

      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          track_progress: true # âœ¨ Enables tracking comments
          prompt: |
            You are a senior code reviewer. Review this pull request and provide comprehensive feedback.

            REPO: ${{ github.repository }}
            PR NUMBER: ${{ github.event.pull_request.number }}

            REVIEW PROCESS:
            1. Use `gh pr view` to understand the PR context
            2. Use `gh pr diff` to examine the code changes
            3. Reference CLAUDE.md and README.md for guidance on style and conventions
            4. Create a pending review using `gh pr review --pending`
            5. Add inline comments using `mcp__github_inline_comment__create_inline_comment` for specific code issues
            6. Submit the review using `gh pr review --submit` with overall feedback

            FOCUS AREAS:
            - Code quality and best practices
            - Potential bugs or issues
            - Performance considerations
            - Security implications
            - Test coverage
            - Documentation updates if needed
            - Error handling and edge cases

            REVIEW GUIDELINES:
            - Provide constructive feedback with specific suggestions for improvement
            - Use inline comments to highlight specific areas of concern
            - Acknowledge good practices and improvements
            - Be respectful and educational in your feedback
            - Consider the PR's scope and avoid scope creep suggestions

            If the changes look good overall, approve the PR. If there are critical issues, request changes. Otherwise, provide comments for consideration.

          claude_args: |
            --allowedTools "mcp__github_inline_comment__create_inline_comment,Bash(gh pr comment:*),Bash(gh pr diff:*),Bash(gh pr view:*)"
